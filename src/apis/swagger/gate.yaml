swagger: '2.0'
info:
  version: 1.0.0
  title: gate api
host: 'localhost:8686'
basePath: /v1
schemes:
  - https
consumes:
  - application/json
produces:
  - application/json
paths:
  /login:
    post:
      summary: Sign-in request
      parameters:
        - in: body
          name: data
          description: Credentials
          required: true
          schema:
            $ref: '#/definitions/UserLogin'
      responses:
        '200':
          description: OK
          headers:
            X-Subject-Token:
              type: string
              description: Auth token for further requests
          schema:
            $ref: '#/definitions/UserToken'
        '400':
          description: Something went wrong
        '401':
          description: Bad username/pass
          
  /stats:
    post:
      summary: Show user statistics
      parameters:
        - in: header
          name: X-Auth-Token
          type: string
          required: true
        - name: date
          in: body
          description: Function name
          required: true
          schema:
            $ref: '#/definitions/UserStatsReq'
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/UserStatsResp'
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token
          
  /project/list:
    post:
      summary: List projects
      parameters:
        - in: header
          name: X-Auth-Token
          type: string
          required: true
      responses:
        '200':
          description: OK
          schema:
            properties:
              functions:
                type: array
                items:
                  $ref: '#/definitions/ProjectItem'
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token
  /project/del:
    post:
      summary: Delete project and all functoins and mwares in it
      parameters:
        - in: header
          name: X-Auth-Token
          type: string
          required: true
        - in: body
          name: data
          description: Project removal options
          required: true
          schema:
            $ref: '#/definitions/ProjectDel'
      responses:
        '200':
          description: OK
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token

  /functions:
    parameters:
      - in: header
        name: X-Auth-Token
        type: string
        required: true
      - name: project
        in: query
        description: Project to work on
        required: false
        type: string
    get:
      tags:
        - function
      summary: List functions
      parameters:
        - in: query
          name: periods
          type: integer
          required: false
          description: Number of stats periods to report
        - in: query
          name: details
          type: string
          required: false
          description: Whether or not to show details about functions (value itself is ignored)
        - in: query
          name: name
          type: string
          required: false
          description: Name of a function to find (useful to resolve ID by name)
      responses:
        '200':
          description: OK
          schema:
            type: array
            items:
              $ref: '#/definitions/FunctionInfo'
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token
    post:
      tags:
        - function
      summary: Create funciton
      parameters:
        - name: data
          in: body
          description: Middleware description
          required: true
          schema:
            $ref: '#/definitions/FunctionAdd'
      responses:
        '200':
          description: OK
          schema:
            type: string
            description: Function ID
            example: 'deadbeef'
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token

  /functions/{fid}:
    parameters:
      - in: header
        name: X-Auth-Token
        type: string
        required: true
      - in: path
        name: fid
        type: string
        required: true
        description: Function ID
    get:
      tags:
        - function
      summary: Show function info (with details)
      parameters:
        - in: query
          name: periods
          type: integer
          required: false
          description: Number of stats periods to report
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/FunctionInfo'
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token
    delete:
      tags:
        - function
      summary: Remove function
      responses:
        '200':
          description: OK
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token
  /functions/{fid}/run:
    parameters:
      - in: header
        name: X-Auth-Token
        type: string
        required: true
      - in: path
        name: fid
        type: string
        required: true
        description: Function ID
    post:
      tags:
        - function
      summary: Run funciton
      parameters:
        - name: data
          in: body
          description: Arguments
          required: false
          schema:
            $ref: '#/definitions/FunctionRun'
      responses:
        '200':
          description: Function run result
          schema:
            $ref: '#/definitions/FunctionRunResult'
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token  
          
  /functions/{fid}/logs:
    parameters:
      - in: header
        name: X-Auth-Token
        type: string
        required: true
      - in: path
        name: fid
        type: string
        required: true
        description: Function ID
    get:
      tags:
        - function
      summary: Show function logs
      responses:
        '200':
          description: OK
          schema:
            type: array
            items:
              $ref: '#/definitions/FunctionLogEntry'
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token
          
  /functions/{fid}/stats:
    parameters:
      - in: header
        name: X-Auth-Token
        type: string
        required: true
      - in: path
        name: fid
        type: string
        required: true
        description: Function ID
    get:
      tags:
        - function
      summary: Show function stats
      parameters:
        - in: query
          name: periods
          type: integer
          required: false
          description: Number of stats periods to report
      responses:
        '200':
          description: OK
          schema:
            type: array
            items:
              $ref: '#/definitions/FunctionStatsResp'
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token
          
  /functions/{fid}/state:
    parameters:
      - in: header
        name: X-Auth-Token
        type: string
        required: true
      - in: path
        name: fid
        type: string
        required: true
        description: Function ID
    get:
      tags:
        - function
      summary: Get function state
      responses:
        '200':
          description: OK
          schema:
            type: string
            example: 'ready, deactivated'
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token
    put:
      tags:
        - function
      summary: Set function state
      parameters:
        - in: body
          name: v
          schema:
            type: string
          required: true
          description: State to set
      responses:
        '200':
          description: OK
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token
          
  /functions/{fid}/wait:
    parameters:
      - in: header
        name: X-Auth-Token
        type: string
        required: true
      - in: path
        name: fid
        type: string
        required: true
        description: Function ID
    post:
      tags:
        - function
      summary: Wait for an event on a function
      parameters:
        - in: body
          name: data
          schema:
            $ref: '#/definitions/FunctionWait'
          required: false
          description: Wait options
      responses:
        '200':
          description: OK
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token
        '524':
          description: TImeout has occurred

          
  /functions/{fid}/userdata:
    parameters:
      - in: header
        name: X-Auth-Token
        type: string
        required: true
      - in: path
        name: fid
        type: string
        required: true
        description: Function ID
    get:
      tags:
        - function
      summary: Get function associated text
      responses:
        '200':
          description: OK
          schema:
            type: string
            example: 'This is my first function :)'
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token
    put:
      tags:
        - function
      summary: Set function associated text
      parameters:
        - in: body
          name: data
          schema:
            type: string
          required: true
          description: State to set
      responses:
        '200':
          description: OK
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token
          
  /functions/{fid}/authctx:
    parameters:
      - in: header
        name: X-Auth-Token
        type: string
        required: true
      - in: path
        name: fid
        type: string
        required: true
        description: Function ID
    get:
      tags:
        - function
      summary: Get function auth context (controlling middleware) name
      responses:
        '200':
          description: OK
          schema:
            type: string
            example: 'my_authjwt'
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token
    put:
      tags:
        - function
      summary: Set function auth context
      parameters:
        - in: body
          name: data
          schema:
            type: string
          required: true
          description: Auth mware name to set (empty string is accepted and unsets the context)
      responses:
        '200':
          description: OK
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token

  /functions/{fid}/size:
    parameters:
      - in: header
        name: X-Auth-Token
        type: string
        required: true
      - in: path
        name: fid
        type: string
        required: true
        description: Function ID
    get:
      tags:
        - function
      summary: Get function size
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/FunctionSize'
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token
    put:
      tags:
        - function
      summary: Set function size
      parameters:
        - in: body
          name: data
          schema:
            $ref: '#/definitions/FunctionSize'
          required: true
          description: Mware name to set (empty string is accepted and unsets the context)
      responses:
        '200':
          description: OK
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token
          
  /functions/{fid}/sources:
    parameters:
      - in: header
        name: X-Auth-Token
        type: string
        required: true
      - in: path
        name: fid
        type: string
        required: true
        description: Function ID
    get:
      tags:
        - function
      summary: Get function sources
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/FunctionSources'
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token
    put:
      tags:
        - function
      summary: Set (update) function sources
      parameters:
        - in: body
          name: data
          schema:
            $ref: '#/definitions/FunctionSources'
          required: true
      responses:
        '200':
          description: OK
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token

  /functions/{fid}/middleware:
    parameters:
      - in: header
        name: X-Auth-Token
        type: string
        required: true
      - in: path
        name: fid
        type: string
        required: true
        description: Function ID
    get:
      tags:
        - function
      summary: Get function middleware
      responses:
        '200':
          description: OK
          schema:
            type: array
            items:
              type: string
              description: Name of attached middleware
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token
    post:
      tags:
        - function
      summary: Attach mware to function
      parameters:
        - in: body
          name: mwid
          required: true
          schema:
            type: string
          description: Middleware ID
      responses:
        '200':
          description: OK
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token
  /functions/{fid}/middleware/{mid}:
    parameters:
      - in: header
        name: X-Auth-Token
        type: string
        required: true
      - in: path
        name: fid
        type: string
        required: true
        description: Function ID
      - in: path
        name: mid
        type: string
        required: true
        description: Middleware ID
    delete:
      tags:
        - function
      summary: Detach mware from function
      responses:
        '200':
          description: OK
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token

  /functions/{fid}/s3buckets:
    parameters:
      - in: header
        name: X-Auth-Token
        type: string
        required: true
      - in: path
        name: fid
        type: string
        required: true
        description: Function ID
    get:
      tags:
        - function
      summary: Get function S3 buckets
      responses:
        '200':
          description: OK
          schema:
            type: array
            items:
              type: string
              description: Name of attached S3 buckets
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token
    post:
      tags:
        - function
      summary: Attach S3 bucket to function
      parameters:
        - in: body
          name: bname
          required: true
          schema:
            type: string
          description: Bucket name
      responses:
        '200':
          description: OK
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token
  /functions/{fid}/s3buckets/{bname}:
    parameters:
      - in: header
        name: X-Auth-Token
        type: string
        required: true
      - in: path
        name: fid
        type: string
        required: true
        description: Function ID
      - in: path
        name: bname
        type: string
        required: true
        description: Bucket name
    delete:
      tags:
        - function
      summary: Detach S3 bucket from function
      responses:
        '200':
          description: OK
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token

  /functions/{fid}/triggers:
    parameters:
      - in: path
        name: fid
        description: Funciton ID
        required: true
        type: string
      - in: header
        name: X-Auth-Token
        type: string
        required: true
    get:
      tags:
        - triggers
        - function
      summary: List event triggers for the function
      responses:
        '200':
          description: OK
          schema:
              type: array
              items:
                $ref: '#/definitions/FunctionEvent'
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token
    post:
      tags:
        - triggers
      summary: Add event trigger for the function
      parameters:
        - name: data
          in: body
          description: Event trigger description
          required: true
          schema:
            $ref: '#/definitions/FunctionEvent'
      responses:
        '200':
          description: OK
          schema:
            type: string
            description: ID of a newly created event trigger
            example: 'deadbeef'
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token

  /functions/{fid}/triggers/{eid}:
    parameters:
      - in: path
        name: fid
        description: Funciton ID
        required: true
        type: string
      - in: path
        name: eid
        description: Event trigger ID
        required: true
        type: string
      - in: header
        name: X-Auth-Token
        type: string
        required: true
    get:
      tags:
        - triggers
        - function
      summary: Get event trigger details
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/FunctionEvent'
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token
    delete:
      tags:
        - triggers
      summary: Remove event trigger
      responses:
        '200':
          description: OK
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token
  /middleware:
    parameters:
      - in: header
        name: X-Auth-Token
        type: string
        required: true
      - name: project
        in: query
        description: Project to work on
        required: false
        type: string
    get:
      tags:
        - mware
      summary: List middleware
      parameters:
        - in: query
          name: type
          type: string
          required: false
          description: Middleware type to list
        - in: query
          name: details
          type: string
          required: false
          description: Whether or not to show mware details (value itself is ignored)
        - in: query
          name: name
          type: string
          required: false
          description: Name of a mware item to find (useful to resolve ID by name)
      responses:
        '200':
          description: OK
          schema:
            type: array
            items:
              $ref: '#/definitions/MwareInfo'
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token
    post:
      tags:
        - mware
      summary: Create middleware
      parameters:
        - name: data
          in: body
          description: Middleware description
          required: true
          schema:
            $ref: '#/definitions/MwareAdd'
      responses:
        '200':
          description: OK
          schema:
            type: string
            description: Mware ID
            example: 'deadbeef'
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token
  /middleware/{mid}:
    parameters:
      - in: path
        name: mid
        description: Middleware ID
        required: true
        type: string
      - in: header
        name: X-Auth-Token
        type: string
        required: true
    get:
      tags:
        - mware
      summary: Show mware info
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/MwareInfo'
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token
    delete:
      tags:
        - mware
      summary: Create middleware
      responses:
        '200':
          description: OK
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token
  /s3/access:
    get:
      tags:
        - mware
        - s3
      summary: Request keys for S3 access
      parameters:
        - in: header
          name: X-Auth-Token
          type: string
          required: true
        - name: project
          in: query
          description: Project to work on
          required: false
          type: string
        - name: data
          in: body
          description: Middleware to remove
          required: true
          schema:
            $ref: '#/definitions/S3Access'
      responses:
        '200':
          description: Middleware removed
          schema:
            $ref: '#/definitions/S3Creds'
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token
  /deployments:
    parameters:
      - in: header
        name: X-Auth-Token
        type: string
        required: true
      - name: project
        in: query
        description: Project to work on
        required: false
        type: string
    get:
      tags:
        - deploy
      summary: List deployments
      parameters:
        - in: query
          name: name
          type: string
          required: false
          description: Name of deployment to find (useful to resolve ID by name)
      responses:
        '200':
          description: All objects has been /add-ed
          schema:
            $ref: '#/definitions/DeployInfo'
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token
    post:
      tags:
        - deploy
      parameters:
        - name: data
          in: body
          description: Deployment description
          required: true
          schema:
            $ref: '#/definitions/DeployStart'
      summary: Create deployment
      responses:
        '200':
          description: OK
          schema:
            type: string
            description: Deployment ID
            example: 'deadbeef'
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token
  /deployments/{did}:
    parameters:
      - in: header
        name: X-Auth-Token
        type: string
        required: true
      - name: did
        in: path
        description: Deployment ID
        required: true
        type: string
    get:
      tags:
        - deploy
      summary: Show info about deployment
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/DeployInfo'
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token
    delete:
      tags:
        - deploy
      summary: Remove deployment
      responses:
        '200':
          description: OK
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token

  /auths:
    parameters:
      - in: header
        name: X-Auth-Token
        type: string
        required: true
      - name: project
        in: query
        description: Project to work on
        required: false
        type: string
    get:
      tags:
        - deploy
        - auth
      summary: List AaaS ()authentication-as-a-service) deployments
      responses:
        '200':
          description: All objects has been /add-ed
          schema:
            $ref: '#/definitions/AuthInfo'
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token
    post:
      tags:
        - deploy
        - auth
      parameters:
        - name: data
          in: body
          description: AaaS description
          required: true
          schema:
            $ref: '#/definitions/AuthAdd'
      summary: Create AaaS deployment
      responses:
        '200':
          description: OK
          schema:
            type: string
            description: Deployment ID
            example: 'deadbeef'
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token
  /auths/{aid}:
    parameters:
      - in: header
        name: X-Auth-Token
        type: string
        required: true
      - name: aid
        in: path
        description: Deployment ID
        required: true
        type: string
    get:
      tags:
        - deploy
        - auth
      summary: Show info about AaaS deployment
      responses:
        '200':
          description: OK
          schema:
            $ref: '#/definitions/DeployInfo'
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token
    delete:
      tags:
        - deploy
        - auth
      summary: Remove AaaS deployment
      responses:
        '200':
          description: OK
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token
  
  /info/langs:
    post:
      summary: Show supported languages
      parameters:
        - in: header
          name: X-Auth-Token
          type: string
          required: true
      responses:
        '200':
          description: OK
          schema:
            properties:
              langs:
                type: array
                items:
                  type: string
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token
  /info/mwares:
    post:
      summary: Show supported mware types
      parameters:
        - in: header
          name: X-Auth-Token
          type: string
          required: true
      responses:
        '200':
          description: OK
          schema:
            properties:
              mwares:
                type: array
                items:
                  type: string
        '400':
          description: Bad request
          schema:
            $ref: '#/definitions/GateError'
        '401':
          description: Need to authenticate
        '403':
          description: Bad authentication token
definitions:
  UserLogin:
    required:
      - username
      - password
    properties:
      username:
        type: string
        example: john@doe.com
      password:
        type: string
        example: secretpass123
  UserToken:
    properties:
      expires:
        type: string
        description: UnixDate time of Token expiration
      endpoint:
        type: string
        description: Gate addr:port to talk to further
  GateError:
    properties:
      code:
        type: integer
        description: Error code
      message:
        type: string
        description: Error text
  ProjectItem:
    properties:
      project:
        type: string
        example: my-project
  ProjectDel:
    required:
      - project
    properties:
      project:
        type: string
        example: my-project
  FunctionInfo:
    properties:
      id:
        type: string
        description: Unique ID, system-wide
      name:
        type: string
        description: Function name (reported for /list/info operation)
      project:
        type: string
        description: Project the FN lives in
      labels:
        type: array
        items:
          type: string
      state:
        type: string
        description: Function state
        example: ready
      version:
        type: string
        description: Function code version
        example: 0
      url:
        type: string
        description: URL for direct calls if event.source is "url"
        example: "/call/ki4r4380984csdlsiduo9049843jk"
      code:
        $ref: '#/definitions/FunctionCode'
      size:
        $ref: '#/definitions/FunctionSize'
      stats:
        type: array
        description: Per-period statistics, see FunctionStatsResp for details
        items:
          $ref: '#/definitions/FunctionStats'
      authctx:
        type: string
        description: ID of auth mware that must authorize the caller before running FN
      userdata:
        type: string
        description: The data provided during /add call
      mware:
        type: array
        items:
          type: string
          example:
            - mymariadb
              mys3strg
      s3buckets:
        type: array
        items:
          type: string
          example:
            - foobucket
              barbucket

  UserStatsReq:
    type: object
    description: Request for user statistics
    properties:
      periods:
        type: integer
        description: Numer of periods back to request (default 0), the top-most stat will be "till now"
  FunctionStatsResp:
    type: object
    description: Responce with FN stats
    properties:
      stats:
        type: array
        description: Per-period statistics, "till"-sorted descending. Each period is incremental to previous. The 0th one is "till now"
        items:
          $ref: '#/definitions/FunctionStats'
  UserStatsResp:
    type: object
    description: Responce with user stats
    properties:
      stats:
        type: array
        description: Per-period statistics, "till"-sorted descending. Each period is incremental to previous. The 0th one is "till now"
        items:
          $ref: '#/definitions/UserStats'

  FunctionStats:
    type: object
    description: Statistics about function
    properties:
      called:
        type: integer
        description: Number of funciton invovations so far
        example: 42
      timeouts:
        type: integer
        description: Number of timeouts (included in called)
      errors:
        type: integer
        description: Number of fn run errors (included in called)
      lastcall:
        type: string
        description: Time or last call in RFC1123Z format
        example: 'Mon Dec 25 14:18:18 MSK 2017'
      time:
        type: integer
        description: Total time spent in function code (in microseconds)
        example: 123000
      gbs:
        type: number
        description: Mem*time consumed so far, in GB * sec
      bytesout:
        type: integer
        description: Total size of JSON objects returned from function
      till:
        type: string
        description: Time (RFC1123Z) till which stats are collected (if empty means "till now")
      from:
        type: string
        description: Time (RFC1123Z) from which stats are collected (if empty means "till tenant creation time")
  UserStats:
    type: object
    description: Statistics about user
    properties:
      called:
        type: integer
        description: Number of all funcitons invocations so far
        example: 42
      gbs:
        type: number
        description: Mem*time consumed so far, in GB * sec
      bytesout:
        type: integer
        description: Total size of JSON objects returned from all user functions
      till:
        type: string
        description: Time (RFC1123Z) till which stats are collected (if empty means "till now")
      from:
        type: string
        description: Time (RFC1123Z) from which stats are collected (if empty means "till tenant creation time")
  FunctionEventCron:
    type: object
    description: Cron string and arguments
    required:
      - tab
      - args
    properties:
      tab:
        type: string
        description: Cron string in classical notation
        example: '* * * * * *'
      args:
        type: object
        description: Dict with args to pass to FN when this cron fires
        additionalProperties:
          type: string
        example:
          - arg: value
  FunctionEventS3:
    type: object
    description: Bucket to receive envets from
    required:
      - bucket
      - ops
    properties:
      bucket:
        type: string
        description: 'Bucket name in S3'
      ops:
        type: string
        description: 'Comma-separated list of operations'
        example: 'put'
      pattern:
        type: string
        description: 'Pattern to match the object key'
        example: '/foo/bar/*.img'
  FunctionEvent:
    type: object
    description: Event specification
    required:
      - name
      - source
    properties:
      id:
        type: string
        description: Used in responces
      name:
        type: string
      source:
        type: string
        description: 'Event source type, supported by platform'
        example: 'url, cron, s3'
      cron:
        $ref: '#/definitions/FunctionEventCron'
      s3:
        $ref: '#/definitions/FunctionEventS3'
  FunctionSources:
    type: object
    description: Sources description
    required:
      - type
    properties:
      type:
        type: string
        description: Sources type ("code")
        example: code
      code:
        type: string
        description: Base64 encoded source file
        example: 'cHJpbnQoIkhlbGxvIHdvcmxkIikK'
  FunctionCode:
    type: object
    description: Code description
    required:
      - lang
    properties:
      lang:
        type: string
        description: 'Language ("python", "golang", ...)'
        example: python
      env:
        type: array
        items:
          type: string
          example: FOO=bar
  FunctionSize:
    type: object
    description: Function runtime size specification
    properties:
      memory:
        type: integer
        description: size in megabytes
        example: 128
      timeout:
        type: integer
        description: timeout in milliseconds
        example: 10
      rate:
        type: integer
        description: max calls per second
        example: 100
      burst:
        type: integer
        description: rate-limiter burst value
        example: 10
  FunctionAdd:
    required:
      - name
      - sources
      - code
    properties:
      name:
        type: string
        example: my-function
      project:
        type: string
        example: my-project
      userdata:
        type: string
        description: And string user wishes to keep with this FN
      authctx:
        type: string
        description: ID of auth mware
      sources:
        $ref: '#/definitions/FunctionSources'
      code:
        $ref: '#/definitions/FunctionCode'
      size:
        $ref: '#/definitions/FunctionSize'
      mware:
        type: array
        items:
          type: string
          example: mymariadb
      s3buckets:
        type: array
        items:
          type: string
          example: foobucket

  FunctionLogEntry:
    description: Entry in function logs
    properties:
      event:
        type: string
        description: Event name
        example: "run"
      ts:
        type: string
        description: Timestamp in UnixDate format
      text:
        type: string
        description: Log entry text (stdout and stderr typically)
  FunctionWait:
    description: Wait options
    properties:
      timeout:
        type: integer
        description: Time in msec to wait for an event to occur
      version:
        type: string
        description: >-
                When a function version equals or (!) greater than this becomes
                available for execution, the event occurs. Note, that older versions
                may still be there when the event happens.
  FunctionRun:
    description: Function ID and arguments
    required:
      - args
    properties:
      args:
        type: object
        description: Dict with arguments
        additionalProperties:
          type: string
        example:
          - foo: bar
            baz: fuz
  FunctionRunResult:
    required:
      - code
      - return
    properties:
      code:
        type: integer
        description: Result of the execution (0 == all went OK)
      return:
        type: string
        description: JSON-encoded function return object
        example: {"message": "hello, world"}
      stdout:
        type: string
        description: String with stdout captured while running
      stderr:
        type: string
        description: String with stderr captured while running
  MwareAdd:
    type: object
    description: Middleware specification
    required:
      - name
      - type
    properties:
      name:
        type: string
        description: Just an name
        example: mymariadb
      type:
        type: string
        description: Middleware type
        example: maria
      userdata:
        type: string
        description: And string user wishes to keep with this mware
  MwareInfo:
    type: object
    description: Middleware inforamtion
    properties:
      id:
        type: string
        description: Mware ID (reported for list/info operation)
      name:
        type: string
        description: Mware name
      project:
        type: string
        description: Project the FN lives in
      labels:
        type: array
        items:
          type: string
      type:
        type: string
        description: Middleware type
        example: maria
      userdata:
        type: string
        description: String provided during /add call
      disk_usage:
        type: integer
        description: Disk usage in KBytes
  S3Access:
    type: object
    description: Description of the access requested
    properties:
      bucket:
        type: string
        description: if empty, access to "the whole s3" within the project is requested
      lifetime:
        type: integer
        description: Key validity period in seconds
      access:
        type: array
        description: List of options. The "hidden" one is to be set for keys that are not planned to be shown to user (e.g. -- used by UI for itself).
        items:
          type: string
          example: hidden
  S3Creds:
    type: object
    description: Keys to access S3
    properties:
      endpoint:
        type: string
        description: Addr:Port pair to talk S3 protocol to
      key:
        type: string
      secret:
        type: string
      expires:
        type: integer
        description: Lifetime in seconds
  DeployItem:
    type: object
    description: Item to deploy (function or middleware)
    properties:
      function:
        $ref: '#/definitions/FunctionAdd'
      mware:
        $ref: '#/definitions/MwareAdd'
  DeployStart:
    type: object
    description: Description of deployment
    required:
      - name
      - items
    properties:
      project:
        type: string
      name:
        type: string
      items:
        type: array
        items:
          $ref: '#/definitions/DeployItem'
  DeployItemInfo:
    type: object
    description: Info about a deploy item
    properties:
      type:
        type: string
        description: Item type, "function" or "middleware"
      name:
        type: string
      state:
        type: string
        description: Item state, "ready", "dead" or other. See function/mware states for details
  DeployInfo:
    type: object
    description: Info about deployment
    properties:
      id:
        type: string
        description: Mware ID (reported for list/info operation)
      name:
        type: string
        description: Mware name
      project:
        type: string
        description: Project the FN lives in
      labels:
        type: array
        items:
          type: string
      state:
        type: string
        description: State of deploying -- "starting", "ready", "stalled" or "terminating"
      items:
        type: array
        items:
          $ref: '#/definitions/DeployItemInfo'
          
  AuthInfo:
    type: object
    description: AaaS entry description
    properties:
      id:
        type: string
        description: Deployment ID
      name:
        type: string
        description: Deployment name
        
  AuthAdd:
    type: object
    description: AaaS creation request
    properties:
      name:
        type: string
      type:
        type: string
        description: AaaS type.
        example: jwt
